(function(){"use strict";(function(){(()=>{var B={};B.d=(i,t)=>{for(var e in t)B.o(t,e)&&!B.o(i,e)&&Object.defineProperty(i,e,{enumerable:!0,get:t[e]})},B.o=(i,t)=>Object.prototype.hasOwnProperty.call(i,t),B.r=i=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})};var ge={};B.r(ge),B.d(ge,{QueryManager:()=>Me});var M=function(i){return Promise.resolve(i)},w=function(i){return new Promise(i)},d={InvalidUpdateColumn:"invalid_update_column",UndefinedColumn:"undefined_column",UndefinedValue:"undefined_value",UndefinedColumnName:"undefined_column_name",UndefinedDbName:"undefined_database_name",UndefinedColumnValue:"undefined_column_value",NotArray:"not_array",NoValueSupplied:"no_value_supplied",ColumnNotExist:"column_not_exist",NoIndexFound:"no_index_found",InvalidOp:"invalid_operator",NullValue:"null_value",WrongDataType:"wrong_data_type",TableNotExist:"table_not_exist",DbNotExist:"db_not_exist",ConnectionAborted:"connection_aborted",ConnectionClosed:"connection_closed",NotObject:"not_object",InvalidConfig:"invalid_config",DbBlocked:"Db_blocked",IndexedDbNotSupported:"indexeddb_not_supported",NullValueInWhere:"null_value_in_where",InvalidJoinQuery:"invalid_join_query",InvalidQuery:"invalid_query",ImportScriptsFailed:"import_scripts_failed",MethodNotExist:"method_not_exist",Unknown:"unknown",InvalidMiddleware:"invalid_middleware"};Object.assign(d,{InvalidOrderQuery:"invalid_order_query",InvalidGroupQuery:"invalid_group_query"});var me;(function(i){i.Registered="registerd",i.Failed="failed",i.NotStarted="not_started"})(me||(me={}));var k;(function(i){i.String="string",i.Object="object",i.Array="array",i.Number="number",i.Boolean="boolean",i.Null="null",i.DateTime="date_time"})(k||(k={}));var g;(function(i){i.InitDb="init_db",i.Get="get",i.Set="set",i.Select="select",i.Insert="insert",i.Update="update",i.Remove="remove",i.OpenDb="open_db",i.Clear="clear",i.DropDb="drop_db",i.Count="count",i.ChangeLogStatus="change_log_status",i.Terminate="terminate",i.Transaction="transaction",i.CloseDb="close_db",i.Union="union",i.Intersect="intersect",i.ImportScripts="import_scripts",i.Middleware="middleware"})(g||(g={}));var _e;(function(i){i.RequestQueueEmpty="requestQueueEmpty",i.RequestQueueFilled="requestQueueFilled",i.Upgrade="upgrade",i.Create="create",i.Open="open"})(_e||(_e={}));var h;(function(i){i.Where="where",i.Like="like",i.Regex="regex",i.In="in",i.Equal="=",i.Between="-",i.GreaterThan=">",i.LessThan="<",i.GreaterThanEqualTo=">=",i.LessThanEqualTo="<=",i.NotEqualTo="!=",i.Aggregate="aggregate",i.Max="max",i.Min="min",i.Avg="avg",i.Count="count",i.Sum="sum",i.List="list",i.Or="or",i.Skip="skip",i.Limit="limit",i.And="and",i.IgnoreCase="ignoreCase",i.Then="then"})(h||(h={}));var J;(function(i){i.ReadOnly="readonly",i.ReadWrite="readwrite"})(J||(J={}));var V;(function(i){i.First="f",i.Last="l",i.Any="a"})(V||(V={}));var be;(function(i){i.Connected="connected",i.Closed="closed",i.NotStarted="not_started",i.UnableToStart="unable_to_start",i.ClosedByJsStore="closed_by_jsstore"})(be||(be={}));var Ve=function(){function i(t){this.columns=[],this.autoIncColumnValue={},this.columns=this.setColumn(t.columns),this.name=t.name,this.alter=t.alter||{}}return i.prototype.setColumn=function(t){var e=[],r=function(a){var u=t[a];u.name=a,u.autoIncrement&&(n.autoIncColumnValue[a]=0),u.primaryKey&&(n.primaryKey=a),u.enableSearch=u.enableSearch==null?!0:u.enableSearch;var s=n.columns.indexOf(function(c){return c.name===a});if(s<0)e.push(u);else{var l=n.columns[s];Object.assign(l,u)}},n=this;for(var o in t)r(o);return e},i}(),I=function(){function i(){}return i.autoIncrementKey=function(t,e){return"JsStore_".concat(t,"_").concat(e,"_Value")},i.set=function(t,e,r){r.tx||r.createTransaction([i.tableName]);var n=r.objectStore(i.tableName);return w(function(o,a){var u=n.put({key:t,value:e});u.onsuccess=function(){o()},u.onerror=a})},i.get=function(t,e){e.tx||e.createTransaction([i.tableName]);var r=e.objectStore(i.tableName);return w(function(n,o){var a=r.get(e.keyRange(t));a.onsuccess=function(){var u=a.result;n(u&&u.value)},a.onerror=o})},i.remove=function(t,e){e.tx||e.createTransaction([i.tableName]);var r=e.objectStore(i.tableName);return w(function(n,o){var a=r.delete(e.keyRange(t));a.onsuccess=n,a.onerror=o})},i.tableName="JsStore_Meta",i.dbSchema="JsStore_DbSchema",i}(),Fe=function(){function i(t){this.name=t.name,this.version=t.version||1,t.tables.push({name:I.tableName,columns:{key:{primaryKey:!0},value:{enableSearch:!1}}}),this.tables=t.tables.map(function(e){return new Ve(e)})}return i}(),xe=function(i,t){for(var e in i)t(e,i[e])},x=function(){function i(t,e){this.type=t,this.info_=e,this.message=this.getMsg_()}return i.prototype.log=function(t){this.status&&console.log(t)},i.prototype.throw=function(){throw this.get()},i.prototype.logError=function(){console.error(this.get()),console.trace()},i.prototype.get=function(){return{message:this.message,type:this.type}},i.prototype.getMsg_=function(){var t,e,r,n=this.info_,o=(t={},t[d.NotArray]=function(){r="Supplied value is not an array"},t[d.UndefinedColumn]=function(){r="Column is undefined in Where"},t[d.UndefinedValue]=function(){r="Value is undefined in Where"},t[d.UndefinedColumnName]=function(){r="Column name is undefined '"+n.TableName+"'"},t[d.UndefinedDbName]=function(){r="Database name is not supplied"},t[d.UndefinedColumnValue]=function(){r="Column value is undefined"},t[d.NoValueSupplied]=function(){r="No value is supplied"},t[d.InvalidOp]=function(){r="Invalid Op Value '"+n.Op+"'"},t[d.ColumnNotExist]=function(){var s=n.column;r=n.isOrder?n.isJoin?"Column '".concat(s,"' in order query is invalid. Please use '<table>.<column>' format for specifying a column in join query."):"Column '".concat(s,"' in order query does not exist"):"Column '".concat(s,"' does not exist")},t[d.NoIndexFound]=function(){r="No index found for column '"+n.column+"'. Query can not be executed without index."},t[d.NullValue]=function(){r="Null value is not allowed for column '"+n.ColumnName+"'"},t[d.WrongDataType]=function(){r="Supplied value for column '"+n.column+"' have wrong data type"},t[d.TableNotExist]=function(){r="Table '"+n.tableName+"' does not exist"},t[d.DbNotExist]=function(){r="Database with name ".concat(n.dbName," does not exist")},t[d.NotObject]=function(){r="supplied value is not object"},t[d.InvalidOp]=function(){r="Invalid Config '"+n.Config+" '"},t[d.DbBlocked]=function(){r="database is blocked, cant be deleted right now"},t[d.NullValueInWhere]=function(){r="Null/undefined is not allowed in where. Column '".concat(n.column,"' has null")},t[d.MethodNotExist]=function(){r="method '".concat(n,"' does not exist.")},t[d.IndexedDbNotSupported]=function(){r="Browser does not support indexeddb"},t.getInfo=function(){r=n},t[d.InvalidJoinQuery]=function(){o.getInfo()},t[d.ImportScriptsFailed]=function(){o.getInfo()},t[d.InvalidMiddleware]=function(){r="No function ".concat(n," is found.")},t);Object.assign(o,(e={},e[d.InvalidOrderQuery]=function(){o.getInfo()},e[d.InvalidGroupQuery]=function(){o.getInfo()},e));var a=this.type,u=o[a];return u?u():(a||(this.type=d.Unknown),r=this.message),r},i}(),we=function(){function i(){this.logger=new x(null)}return i.prototype.emptyTx=function(){!this.tx||(this.tx.oncomplete=null,this.tx.onabort=null,this.tx.onerror=null,this.tx=null)},i.prototype.createTransactionIfNotExist=function(t,e){this.tx||this.createTransaction(t,e)},i.prototype.createTransaction=function(t,e){var r=this;return e===void 0&&(e=J.ReadWrite),this.tx=this.con.transaction(t,e),w(function(n,o){r.tx.oncomplete=n,r.tx.onabort=n,r.tx.onerror=o})},i.prototype.keyRange=function(t,e){var r;switch(e){case h.Between:r=IDBKeyRange.bound(t.low,t.high,!1,!1);break;case h.GreaterThan:r=IDBKeyRange.lowerBound(t,!0);break;case h.GreaterThanEqualTo:r=IDBKeyRange.lowerBound(t);break;case h.LessThan:r=IDBKeyRange.upperBound(t,!0);break;case h.LessThanEqualTo:r=IDBKeyRange.upperBound(t);break;default:r=IDBKeyRange.only(t);break}return r},i.prototype.objectStore=function(t){return this.tx.objectStore(t)},i.prototype.abortTransaction=function(){this.tx&&this.tx.abort()},i.prototype.close=function(){var t=this;return this.con&&this.con.close(),w(function(e){t.con=null,setTimeout(e,100)})},i.prototype.initDb=function(t){var e=this,r=!1,n=t.version,o,a=function(u,s){var l=indexedDB.open(t.name,n);l.onsuccess=function(){e.con=l.result,e.con.onversionchange=function(c){c.target.close()},u({isCreated:r,oldVersion:o,newVersion:n})},l.onerror=function(c){console.error("error",c),s(c)},l.onupgradeneeded=function(c){o=c.oldVersion;var f=c.target,v=f.result;r=!0;var y=f.transaction,m=v.objectStoreNames,p=function(T){var _=T.primaryKey?{keyPath:T.primaryKey}:{autoIncrement:!0},S=v.createObjectStore(T.name,_);T.columns.forEach(function(O){b(S,O)})},b=function(T,_){var S=_.name;if(_.enableSearch&&!T.indexNames.contains(S)){var O=_.primaryKey?{unique:!0}:{unique:_.unique};O.multiEntry=_.multiEntry;var A=_.keyPath==null?S:_.keyPath;T.createIndex(S,A,O)}},j=function(T,_,S){var O=_.columns.findIndex(function(A){return A.name===S});O>=0&&(_.columns.splice(O,1),T.deleteIndex(S))};t.tables.forEach(function(T){if(!m.contains(T.name))return p(T);for(var _=y.objectStore(T.name),S=o+1;S<=n;S++){var O=T.alter[S];if(O){if(O.add){var A=T.setColumn(O.add);A.forEach(function(R){b(_,R),T.columns.push(R)})}xe(O.drop||{},function(R){j(_,T,R)}),xe(O.modify||{},function(R,q){var de=q.multiEntry||q.keyPath||q.unique,se=T.columns.find(function(zt){return zt.name===R}),ye=Object.assign(se,q);ye.name=R,de&&(j(_,T,R),b(_,ye),T.columns.push(ye))})}}});for(var W=function(T,_){var S=m.item(T),O=t.tables.findIndex(function(A){return A.name===S});O<0&&v.deleteObjectStore(S)},D=0,Q=m.length;D<Q;D++)W(D)}};return w(a)},i}(),z=function(i){return Promise.all(i)},L=function(i){return Promise.reject(i)},te=function(i){var t=i instanceof x;if(t)return i.logError(),i.get();var e=void 0;return i.name?(e=new x(i.name),e.message=i.message):(e=new x(i.target.error.name),e.message=i.target.error.message),e.logError(),e.get()},Ke=function(i,t){return t===void 0&&(t=d.InvalidQuery),i.name=t,te(i)},G=function(){function i(){this.rowAffected=0,this.isTxQuery=!1,this.results=[]}return Object.defineProperty(i.prototype,"db",{get:function(){return this.util.db},enumerable:!1,configurable:!0}),i.prototype.table=function(t){var e=t||this.tableName;return this.db.tables.find(function(r){return r.name===e})},i.prototype.primaryKey=function(t){var e=this.query;if(!e.from&&e.store&&e.meta){var r=e.meta.primaryKey;return r==null&&(delete e.store,console.warn("no primary key found for query - ".concat(JSON.stringify(this.query)))),r}var n=this.table(t);if(n==null&&e.store){delete e.store;var o=e.meta;(!o||!o.primaryKey)&&console.warn("no primary key found for query - ".concat(JSON.stringify(this.query),". Please supply primary key in meta field."))}return n.primaryKey},i.prototype.getColumnInfo=function(t,e){return this.table(e).columns.find(function(r){return r.name===t})},i.prototype.onException=function(t,e){return console.error(t),this.util.abortTransaction(),L(Ke(t,e))},i}(),E=function(i){if(i==null)return k.Null;var t=typeof i;switch(t){case"object":if(Array.isArray(i))return k.Array;if(i instanceof Date)return k.DateTime}return t},$=function(i){if(i==null)return!0;switch(typeof i){case"number":return isNaN(i)}return!1},Je=function(){function i(t,e){this.table=t,this.autoIncrementValue=e}return i.prototype.checkAndModifyValues=function(t){var e=this,r;this.query=t;var n=t.values,o=[];return n.every(function(a,u){return r=e.checkAndModifyValue(a),t.ignore&&r&&(o.push(u),r=null),!r}),o.forEach(function(a){n.splice(a,1)}),{err:r,values:n}},i.prototype.checkAndModifyValue=function(t){var e=this,r;return this.table.columns.every(function(n){return r=e.checkAndModifyColumnValue_(n,t),!r}),r},i.prototype.checkNotNullAndDataType_=function(t,e){if(t.notNull&&$(e[t.name]))return this.getError(d.NullValue,{ColumnName:t.name});if(t.dataType&&!$(e[t.name])&&E(e[t.name])!==t.dataType)return this.getError(d.WrongDataType,{column:t.name})},i.prototype.checkAndModifyColumnValue_=function(t,e){var r=e[t.name];t.autoIncrement?$(r)?e[t.name]=++this.autoIncrementValue[t.name]:E(r)===k.Number&&r>this.autoIncrementValue[t.name]&&(this.autoIncrementValue[t.name]=r):t.default!==void 0&&$(r)&&(e[t.name]=t.default);var n=this.query;if(n.validation)return this.checkNotNullAndDataType_(t,e)},i.prototype.getError=function(t,e){return new x(t,e)},i}(),Ge=function(){function i(t){this.table=t}return i.prototype.check=function(t,e){var r=this,n;return typeof t===k.Object?this.table?this.table.columns.every(function(o){return o.name in t&&(n=r.checkByColumn_(o,t[o.name])),!n}):n=new x(d.TableNotExist,{tableName:e}):n=new x(d.NotObject),n},i.prototype.checkByColumn_=function(t,e){if(t.notNull===!0&&$(e))return new x(d.NullValue,{ColumnName:t.name});var r=E(e),n=e!=null;if(t.dataType&&n&&r!==t.dataType&&r!=="object")return new x(d.WrongDataType,{column:t.name});if(n&&r==="object"){var o=["+","-","*","/","{push}"];for(var a in e)if(o.indexOf(a)<0&&t.dataType&&r!==t.dataType)return new x(d.WrongDataType,{column:t.name})}},i}(),X=function(){function i(t){this.db=t}return i.prototype.validate=function(t,e){switch(t){case g.Select:case g.Remove:case g.Count:return this.checkSelect(e);case g.Insert:return this.checkInsertQuery(e);case g.Update:return this.checkUpdate(e)}},i.prototype.getTable_=function(t){return this.db.tables.find(function(e){return e.name===t})},i.prototype.isInsertQryValid=function(t){var e=this.getTable_(t.into),r;if(e)switch(E(t.values)){case k.Array:break;case k.Null:r=new x(d.NoValueSupplied);break;default:r=new x(d.NotArray)}else r=new x(d.TableNotExist,{tableName:t.into});return{table:e,log:r}},i.prototype.checkUpdate=function(t){var e=new Ge(this.getTable_(t.in)).check(t.set,t.in);if(e)return e;if(t.where!=null){if(e=this.checkForNullInWhere_(t),e)return e;this.addGreatAndLessToNotOp_(t)}},i.prototype.checkSelect=function(t){if(!t.store){var e=this.getTable_(t.from);if(!e)return new x(d.TableNotExist,{tableName:t.from})}if(t.where){var r=this.checkForNullInWhere_(t);if(r)return r;this.addGreatAndLessToNotOp_(t)}},i.prototype.checkForNullInWhere_=function(t){for(var e in t.where)if(t.where[e]==null)return new x(d.NullValueInWhere,{column:e})},i.prototype.addGreatAndLessToNotOp_=function(t){var e=t.where,r=function(s,l){return l.findIndex(function(c){return s[c][h.NotEqualTo]!=null})>=0},n=function(s,l){var c;return l.forEach(function(f){c=s[f],c[h.NotEqualTo]!=null&&(s[f][h.GreaterThan]=c[h.NotEqualTo],s[h.Or]===void 0?(s[h.Or]={},s[h.Or][f]={}):s[h.Or][f]===void 0&&(s[h.Or][f]={}),s[h.Or][f][h.LessThan]=c[h.NotEqualTo],delete s[f][h.NotEqualTo])}),s};switch(E(e)){case k.Object:var o=Object.keys(e);if(r(e,o))if(o.length===1)t.where=n(e,o);else{var a=[];o.forEach(function(s){var l;a.push(n((l={},l[s]=e[s],l),[s]))}),t.where=a}break;default:var u=[];e.forEach(function(s){var l=Object.keys(s);r(s,l)&&(s=n(s,l)),u.push(s)}),t.where=u}},i.prototype.checkInsertQuery=function(t){var e=this.isInsertQryValid(t),r=e.table,n=e.log;if(n)return n;if(!t.skipDataCheck){var o=new Je(r,r.autoIncColumnValue),a=o.checkAndModifyValues(t),u=a.values,s=a.err;return t.values=u,s}},i}(),Ue=function(){var i=function(t,e){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(r[o]=n[o])},i(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");i(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),ke=function(i){Ue(t,i);function t(e,r){var n=i.call(this)||this;return n.valuesAffected_=[],e.validation==null&&(e.validation=!0),n.query=e,n.util=r,n.tableName=e.into,n}return t.prototype.execute=function(e){var r=this,n=this.db,o=new X(n).validate(g.Insert,this.query);return o?L(o):e().then(function(a){return r.insertData_(n).then(function(u){return r.query.return?r.valuesAffected_:r.rowAffected})}).catch(function(a){return r.util.abortTransaction(),L(a)})},t.prototype.insertData_=function(e){var r=this,n,o,a=this.query;return a.return?n=function(u){r.valuesAffected_.push(u)}:n=function(u){++r.rowAffected},o=function(){var u=a.upsert?"put":"add";return a.ignore&&!r.isTxQuery?function(s){var l=r.util.con.transaction(a.into,J.ReadWrite),c=l.objectStore(a.into);return c[u](s)}:(r.isTxQuery||r.util.createTransaction([a.into,I.tableName]),r.objectStore=r.util.objectStore(r.tableName),function(s){return r.objectStore[u](s)})}(),z(a.values.map(function(u){return w(function(s,l){var c=o(u);c.onerror=function(f){a.ignore?s():l(f)},c.onsuccess=function(){n(u),s()}})})).then(function(){I.set(I.dbSchema,e,r.util)})},t}(G),He=function(){try{if(indexedDB||(indexedDB=self.mozIndexedDB||self.webkitIndexedDB||self.msIndexedDB),indexedDB)IDBTransaction=IDBTransaction||self.webkitIDBTransaction||self.msIDBTransaction,self.IDBKeyRange=self.IDBKeyRange||self.webkitIDBKeyRange||self.msIDBKeyRange;else return!1}catch{return!1}return!0},Se=typeof self.alert>"u"&&typeof ServiceWorkerGlobalScope>"u",Pe=He(),F=function(i){return Array.isArray(i)},ze=function(i){return typeof i=="object"},re=function(i){return Object.keys(i)},N=function(i){return re(i).length},Z=function(i){for(var t in i)return t},$e=function(){var i=this,t=this.query.case;t?this.pushResult=function(e){var r;i.thenEvaluator.setCaseAndValue(t,e);for(r in t)e[r]=i.thenEvaluator.setColumn(r).evaluate();i.results.push(e)}:this.pushResult=function(e){i.results.push(e)}},Xe=function(){this.query.limit&&(this.limitAtEnd=!0),this.query.skip&&(this.skipAtEnd=!0)},Ze=function(){for(var i=this.results,t=this.primaryKey(),e=new Map,r=0,n=i.length;r<n;r++)e.set(i[r][t],i[r]);this.results=Array.from(e.values())},Ye=function(){function i(){}return i.prototype.setCaseAndValue=function(t,e){this.caseQuery_=t,this.setValue(e)},i.prototype.setCaseAndColumn=function(t,e){return this.caseQuery_=t,this.setColumn(e),this},i.prototype.setColumn=function(t){return this.columnName_=t,this.caseColumnQuery_=this.caseQuery_[this.columnName_],this.length_=this.caseColumnQuery_.length,this},i.prototype.setValue=function(t){return this.value=t,this},i.prototype.evaluate=function(){for(var t=0;t<this.length_;t++)if(this.checkCase_(this.caseColumnQuery_[t])===!0)return this.caseColumnQuery_[t].then;var e=this.caseColumnQuery_[this.length_-1].then;return e??this.value[this.columnName_]},i.prototype.checkCase_=function(t){var e;for(e in t){switch(e){case h.GreaterThan:if(this.value[this.columnName_]>t[e])return!0;break;case h.Equal:if(this.value[this.columnName_]===t[e])return!0;break;case h.LessThan:if(this.value[this.columnName_]<t[e])return!0;break;case h.GreaterThanEqualTo:if(this.value[this.columnName_]>=t[e])return!0;break;case h.LessThanEqualTo:if(this.value[this.columnName_]<=t[e])return!0;break;case h.NotEqualTo:if(this.value[this.columnName_]!==t[e])return!0;break;case h.Between:if(this.value[this.columnName_]>t[e].low&&this.value[this.columnName_]<t[e].high)return!0;break}return!1}},i}(),ne=function(i,t,e,r){if(this.limitAtEnd===!1&&this.skipAtEnd===!1){if(this.skipRecord)return this.limitRecord?r:e;if(this.limitRecord)return t}return i},et=function(i,t,e,r){var n=this;t=e?t[e]:t;var o=this.objectStore.index(i).openCursor(this.util.keyRange(t,e),r),a=ne.call(this,le,ce,rt,tt);return w(function(u,s){o.onerror=s,o.onsuccess=a.call(n,u)})},tt=function(i){var t=this,e=!1;return function(r){var n=r.target.result;n?e&&t.results.length!==t.limitRecord?(t.shouldAddValue(n)&&t.pushResult(n.value),n.continue()):(e=!0,n.advance(t.skipRecord)):i()}},rt=function(i){var t=this,e=!1;return function(r){var n=r.target.result;n?e?(t.shouldAddValue(n)&&t.pushResult(n.value),n.continue()):(e=!0,n.advance(t.skipRecord)):i()}},ce=function(i){var t=this;return function(e){var r=e.target.result;r&&t.results.length!==t.limitRecord?(t.shouldAddValue(r)&&t.pushResult(r.value),r.continue()):i()}},le=function(i){var t=this;return function(e){var r=e.target.result;r?(t.shouldAddValue(r)&&t.pushResult(r.value),r.continue()):i()}},nt=function(){var i=this,t,e=this.query,r=e.store;if(r)return this.results=r,this.setLimitAndSkipEvaluationAtEnd_(),M();var n=e.order,o=this.objectStore;if(n&&n.idbSorting!==!1&&n.by)if(o.indexNames.contains(n.by)){var a=n.type&&n.type.toLowerCase()==="desc"?"prev":"next";this.sorted=!0,t=o.index(n.by).openCursor(null,a)}else return L(new x(d.ColumnNotExist,{column:n.by,isOrder:!0}));else t=o.openCursor();var u=ne.call(this,at,ut,ot,it);return w(function(s,l){t.onerror=l,t.onsuccess=u.call(i,s)})},it=function(i){var t=this,e=!1,r;return function(n){r=n.target.result,r?e&&t.results.length!==t.limitRecord?(t.pushResult(r.value),r.continue()):(e=!0,r.advance(t.skipRecord)):i()}},ot=function(i){var t=this,e=!1,r;return function(n){r=n.target.result,r?e?(t.pushResult(r.value),r.continue()):(e=!0,r.advance(t.skipRecord)):i()}},at=function(i){var t=this,e;return function(r){e=r.target.result,e?(t.pushResult(e.value),e.continue()):i()}},ut=function(i){var t=this,e;return function(r){e=r.target.result,e&&t.results.length!==t.limitRecord?(t.pushResult(e.value),e.continue()):i()}},Te=function(i){return i.replace(/\s/g,"")},st=function(){var i=this.query;if(i.distinct){var t=[],e=this.results[0];for(var r in e)t.push(r);var n=this.primaryKey(),o=t.indexOf(n);t.splice(o,1),i.groupBy=t.length>0?t:null}i.groupBy?i.aggregate?this.executeAggregateGroupBy():this.processGroupBy():i.aggregate&&this.processAggregateQry()},Oe=function(i){var t;if(!this.query.store)if(this.query.join==null)t=this.getColumnInfo(i);else{var e=Te(i).split("."),r=e[1];r==null&&new x(d.ColumnNotExist,{column:i,isOrder:!0,isJoin:!0}).throw(),t=this.getColumnInfo(r,e[0])}if(t==null){var n=this.results[0][i];if(n)return{dataType:E(n),name:i};throw new x(d.ColumnNotExist,{column:i,isOrder:!0})}return t},Ee=function(i,t){return t.localeCompare(i)},Ce=function(i,t){return i.localeCompare(t)},ct=function(i,t){return new String(t).localeCompare(i)},lt=function(i,t){return new String(i).localeCompare(t)},je=function(i,t){return t-i},Ie=function(i,t){return i-t},ft=function(i,t){return t.getTime()-i.getTime()},ht=function(i,t){return i.getTime()-t.getTime()},Le=function(i,t){switch(i.dataType){case k.String:return t.type==="asc"?Ce:Ee;case k.Number:return t.type==="asc"?Ie:je;case k.DateTime:return t.type==="asc"?ht:ft;default:return t.type==="asc"?lt:ct}},Ae=function(i){var t;i.type=Re(i.type);var e=i.by,r=this.thenEvaluator;if(e!=null&&typeof e===k.Object){var n=e,o=function(l,c){return function(f,v){for(var y in n){r.setCaseAndValue(n,f);var m=r.setColumn(y).evaluate();r.setCaseAndValue(n,v);var p=r.setColumn(y).evaluate();switch(typeof f[m]){case k.String:return l(f[m],v[p]);default:return c(f[m],v[p])}}}},a=i.type==="asc"?o(Ce,Ie):o(Ee,je);this.results.sort(a)}else{var u=Oe.call(this,e);if(u!=null){var s=Le(u,i);e=u.name,i.case==null?this.results.sort(function(l,c){return s(l[e],c[e])}):(r.setCaseAndColumn((t={},t[e]=i.case,t),e),this.results.sort(function(l,c){return s(r.setValue(l).evaluate(),r.setValue(c).evaluate())}))}}},Re=function(i){return i==null?"asc":i.toLowerCase()},vt=function(){var i=this.query.order;if(i&&this.results.length>0&&!this.sorted){var t=E(i);if(t===k.Object)Ae.call(this,i);else if(t===k.Array){Ae.call(this,i[0]);for(var e=function(a,u){var s=i[a-1].by,l=i[a],c=l.by,f=Oe.call(r,c);if(f!=null){c=f.name,l.type=Re(l.type);var v=Le(f,l);r.results.sort(function(y,m){return y[s]===m[s]?v(y[c],m[c]):0})}},r=this,n=1,o=i.length;n<o;n++)e(n,o)}}},pt=function(){var i=this.results,t=i.length,e={},r,n=function(){var p=0;for(var b in i)p+=i[b][r]?1:0;return p},o=function(){var p=0;for(var b in i)p=p>i[b][r]?p:i[b][r];return p},a=function(){var p=1/0,b=1/0;for(var j in i)b=i[j][r]?i[j][r]:1/0,p=p<b?p:b;return p},u=function(){var p=0;for(var b in i)p+=i[b][r];return p},s=function(){return u()/t},l=this.query.aggregate;for(var c in l){var f=l[c],v=E(f),y=void 0;switch(c){case"count":y=n;break;case"max":y=o;break;case"min":y=a;break;case"sum":y=u;break;case"avg":y=s}switch(v){case k.String:r=f,e["".concat(c,"(").concat(r,")")]=y();break;case k.Array:for(var m in f)r=f[m],e["".concat(c,"(").concat(r,")")]=y()}}for(var c in e)i[0][c]=e[c];this.results=[i[0]]},dt=function(){var i=this.query.groupBy,t=this.results,e=new Map,r=E(i);if(r!==k.Object)if(r===k.String)for(var n in t)e.set(t[n][i],t[n]);else{var o=void 0;for(var n in t){o="";for(var a in i)o+=t[n][i[a]];e.set(o,t[n])}}else{var u=Object.keys(i).length;if(u===1){var s=Z(i);this.thenEvaluator.setCaseAndColumn(i,s);for(var n in t)e.set(this.thenEvaluator.setValue(t[n]).evaluate(),t[n])}else{var o=void 0;for(var n in t){o="",this.thenEvaluator.setCaseAndValue(i,t[n]);for(var a in i)o+=this.thenEvaluator.setColumn(a).evaluate();e.set(o,t[n])}}}this.results=Array.from(e.values())},yt=function(){var i=this.query.groupBy,t=this.results,e=new Map,r=this.query.aggregate,n,o,a,u,s=function(){var W=function(){return a=e.get(o),a=a?a["count("+u+")"]:0,a+=t[n][u]?1:0,a},D=function(){return a=e.get(o),a=a?a["list("+u+")"]:[],a.push(t[n][u]),a},Q=function(){return a=e.get(o),a=a?a["max("+u+")"]:0,t[n][u]=t[n][u]?t[n][u]:0,a>t[n][u]?a:t[n][u]},T=function(){return a=e.get(o),a=a?a["min("+u+")"]:1/0,t[n][u]=t[n][u]?t[n][u]:1/0,a<t[n][u]?a:t[n][u]},_=function(){return a=e.get(o),a=a?a["sum("+u+")"]:0,a+=t[n][u]?t[n][u]:0,a},S=function(){a=e.get(o);var se=a?a["sum("+u+")"]:0;se+=t[n][u]?t[n][u]:0,t[n]["sum("+u+")"]=se,a=a?a["count("+u+")"]:0,a+=t[n][u]?1:0,t[n]["count("+u+")"]=a};for(var O in r){var A=r[O],R=E(A),q=void 0;switch(O){case h.Count:q=W;break;case h.Max:q=Q;break;case h.Min:q=T;break;case h.Sum:q=_;break;case h.Avg:q=S;break;case h.List:q=D;break}switch(R){case k.String:u=A,t[n]["".concat(O,"(").concat(u,")")]=q();break;case k.Array:for(var de in A)u=A[de],t[n]["".concat(O,"(").concat(u,")")]=q()}}};if(E(i)===k.String)for(n in t)o=t[n][i],s(),e.set(o,t[n]);else for(n in t){o="";for(var l in i)o+=t[n][i[l]];s(),e.set(o,t[n])}t=Array.from(e.values());var c=r.avg;if(c)if(E(c)===k.String)for(n in t){var f=t[n]["sum("+c+")"],v=t[n]["count("+c+")"];t[n]["avg("+c+")"]=f/v,r.count!==c&&delete t[n]["count("+c+")"],r.sum!==c&&delete t[n]["sum("+c+")"]}else{var y=E(r.count)===k.String,m=E(r.sum)===k.String;for(n in t)for(var l in c){var p=c[l],b=t[n]["sum("+p+")"],j=t[n]["count("+p+")"];t[n]["avg("+p+")"]=b/j,y&&(r.count!==p||r.count.indexOf(p)===-1)&&delete t[n]["count("+p+")"],m&&(r.sum!==p||r.sum.indexOf(p)===-1)&&delete t[n]["sum("+p+")"]}}this.results=t},qe=function(i){var t=i.split("%"),e,r;switch(t[1]?(e=t[1],r=t.length>2?V.Any:V.Last):(e=t[0],r=V.First),r){case V.First:return new RegExp("^".concat(e),"i");case V.Last:return new RegExp("".concat(e,"$"),"i");default:return new RegExp("".concat(e),"i")}},Qe=function(i){return E(i)==="object"&&!(i instanceof RegExp)},De=function(i){if(Qe(i)){var t={};for(var e in i)t[e]=i[e]!=null&&Qe(i[e])?De(i[e]):i[e];return t}return i},Y=function(i,t,e){var r=E(i),n=E(t);if(r!==n)return!1;switch(r===k.DateTime&&(i=i.getTime(),t=t.getTime()),e){case h.GreaterThan:return i>t;case h.LessThan:return i<t;case h.LessThanEqualTo:return i<=t;case h.GreaterThanEqualTo:return i>=t;case h.NotEqualTo:return i!==t;default:return i===t}},fe=function(){function i(t,e){this.where=De(t),this.checkFlag=e}return i.prototype.remove=function(t){var e=t.pop(),r=t.reduce(function(n,o){return n&&n[o]},this.where);delete r[e]},i.prototype.check=function(t){var e=!0;if(!this.checkFlag)return e;for(var r in this.where){if(!e)return e;var n=this.where[r],o=t[r];if(E(n)==="object")for(var a in n){if(!e)return e;switch(a){case h.In:e=this.checkIn(r,o);break;case h.Like:e=this.checkLike_(r,o);break;case h.Regex:e=this.checkRegex(r,o);break;case h.Between:case h.GreaterThan:case h.LessThan:case h.GreaterThanEqualTo:case h.LessThanEqualTo:case h.NotEqualTo:e=this.checkComparisionOp_(r,o,a);break;default:e=!1}}else e=Y(n,o)}return e},i.prototype.checkIn=function(t,e){return this.where[t][h.In].find(function(r){return Y(r,e)})!=null},i.prototype.checkLike_=function(t,e){return qe(this.where[t][h.Like]).test(e)},i.prototype.checkRegex=function(t,e){return this.where[t][h.Regex].test(e)},i.prototype.checkComparisionOp_=function(t,e,r){var n=this.where[t][r];return r!=h.Between?Y(e,n,r):Y(e,n.low,">=")&&Y(e,n.high,"<=")},i}(),gt=function(){var i=function(t,e){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(r[o]=n[o])},i(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");i(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),ie=function(i){gt(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.limitAtEnd=!1,e.skipAtEnd=!1,e}return t.prototype.goToWhereLogic=function(){var e=this,r=this.query,n=r.where,o=function(){for(var c in n)if(e.objectStore.indexNames.contains(c))return c}();if(o==null&&(o=Z(n),!r.store))return L(new x(d.NoIndexFound,{column:o}));var a=n[o];if(E(a)==="object"){var u=N(a)>1||N(n)>1;this.whereChecker=new fe(n,u);var s=Z(a);switch(this.whereChecker.remove([o,s]),s){case h.Like:{var l=qe(a[h.Like]);return this.executeRegexLogic(o,l)}case h.Regex:return this.executeRegexLogic(o,a[h.Regex]);case h.In:return this.executeInLogic(o,a[h.In]);case h.Between:case h.GreaterThan:case h.LessThan:case h.GreaterThanEqualTo:case h.LessThanEqualTo:return this.executeWhereLogic(o,a,s,"next");case h.Aggregate:break;default:return this.executeWhereLogic(o,a,null,"next")}}else{var u=N(n)>1;return this.whereChecker=new fe(n,u),this.whereChecker.remove([o]),this.executeWhereLogic(o,a,null,"next")}},t}(G),mt=function(i,t){var e=this,r=this.skipRecord,n=function(u){r===0?e.pushResult(u):--r};this.shouldAddValue=function(u){return t.test(u.key)&&e.whereChecker.check(u.value)};var o=this.objectStore.index(i).openCursor(),a=ne.call(this,le,ce,We,Ne);return w(function(u,s){o.onerror=s,o.onsuccess=a.call(e,u,n)})},Ne=function(i,t){var e=this;return function(r){var n=r.target.result;e.results.length!==e.limitRecord&&n?(e.shouldAddValue(n)&&t(n.value),n.continue()):i()}},We=function(i,t){var e=this;return function(r){var n=r.target.result;n?(e.shouldAddValue(n)&&t(n.value),n.continue()):i()}},_t=function(i,t){var e=this,r=this.skipRecord,n=function(u){r===0?e.pushResult(u):--r},o=ne.call(this,le,ce,We,Ne),a=function(u){return w(function(s,l){var c=e.objectStore.index(i).openCursor(e.util.keyRange(u));c.onsuccess=o.call(e,s,n),c.onerror=l})};return z(t.map(a))},K=function(){return K=Object.assign||function(i){for(var t,e=1,r=arguments.length;e<r;e++){t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(i[n]=t[n])}return i},K.apply(this,arguments)},bt=function(){return new xt(this).execute()},xt=function(){function i(t){this.joinQueryStack_=[],this.currentQueryStackIndex_=0,this.tablesFetched=[],this.results=[],this.select=t}return Object.defineProperty(i.prototype,"query",{get:function(){return this.select.query},enumerable:!1,configurable:!0}),i.prototype.getTable=function(t){return this.select.table(t)},i.prototype.executeSelect=function(t){return new C(t,this.select.util).execute()},i.prototype.execute=function(){var t=this,e=this.query;this.joinQueryStack_=E(e.join)===k.Object?[e.join]:e.join;var r=e.from,n=[];r&&n.push(r);for(var o=this.joinQueryStack_,a=0,u=o.length;a<u;a++){var s=o[a],l=this.getJoinTableInfo_(s.on);s.with===l.table1.table&&(l={table1:l.table2,table2:l.table1});var c=this.checkJoinQuery_(l,s);if(c)return L(c);o[a].joinTableInfo=l,s.with&&n.push(s.with)}return!this.select.isTxQuery&&n.length>0&&this.select.util.createTransaction(n),this.executeSelect({from:r,where:e.where,case:e.case,flatten:e.flatten,store:e.store,meta:e.meta}).then(function(f){return t.results=f.map(function(v){var y;return y={},y[t.currentQueryStackIndex_]=v,y}),t.tablesFetched.push(o[0].joinTableInfo.table1.table),t.startExecutingJoinLogic_()})},i.prototype.onJoinQueryFinished_=function(){if(this.results.length!==0){var t=this.select;try{var e=[],r=re(this.results[0]),n=r.length;this.results.forEach(function(o){for(var a=o[0],u=1;u<n;u++)a=K(K({},a),o[u]);e.push(a)}),t.results=e,t.setLimitAndSkipEvaluationAtEnd_(),t.query.flatten=null;try{t.processOrderBy()}catch(o){return L(new x(d.InvalidOrderQuery,o.message))}}catch(o){return L(new x(d.InvalidJoinQuery,o.message))}}},i.prototype.startExecutingJoinLogic_=function(){var t=this,e=this.joinQueryStack_[this.currentQueryStackIndex_];if(e)try{var r=e.joinTableInfo;return this.executeSelect({from:e.with,where:e.where,case:e.case,flatten:e.flatten,store:e.store,meta:e.meta}).then(function(n){return t.jointables(e,r,n),t.tablesFetched.push(r.table2.table),++t.currentQueryStackIndex_,t.startExecutingJoinLogic_()})}catch(n){return L(new x(d.InvalidJoinQuery,n.message))}else return this.onJoinQueryFinished_()},i.prototype.jointables=function(t,e,r){var n=this,o=t.type,a=[],u=e.table1.column,s=e.table2.column,l=this.tablesFetched.indexOf(e.table1.table),c=this.currentQueryStackIndex_+1,f=t.as,v=f?function(p){for(var b in f){var j=f[b];p[j]===void 0&&(p[j]=p[b],delete p[b])}return p}:function(p){return p},y=function(){var p=0;n.results.forEach(function(b){r.forEach(function(j){b[l][u]===j[s]&&(a[p]=K({},b),a[p++][c]=v(K({},j)))})})},m=function(){var p=0,b,j,W={},D=null;t.store?re(t.store).forEach(function(_){W[_]=D}):n.getTable(e.table2.table).columns.forEach(function(_){W[_.name]=D}),c===1?j=function(_,S){S[l][u]===_[s]&&b.push(_)}:j=function(_,S){var O=S[l];O!=null&&O[u]===_[s]&&b.push(_)};var Q=Object.assign(t.where||{},t.whereJoin||{}),T=new fe(Q,N(Q)>0);n.results.forEach(function(_){b=[],r.forEach(function(S){j(S,_)}),b.length===0&&(b=[W]),b.forEach(function(S){S=v(S),T.check(S)&&(a[p]=K({},_),a[p++][c]=S)})})};switch(o){case"left":m();break;default:y()}this.results=a},i.prototype.getJoinTableInfo_=function(t){t=Te(t);var e=t.split("="),r=e[0].split("."),n=e[1].split("."),o={table1:{table:r[0],column:r[1]},table2:{table:n[0],column:n[1]}};return o},i.prototype.checkJoinQuery_=function(t,e){if(e.store)return null;var r=t.table1,n=t.table2,o=this.getTable(r.table),a=this.getTable(n.table),u;e.with!==n.table&&(u=new x(d.InvalidJoinQuery,"on value should contains value of with")),o.columns.find(function(v){return v.name===r.column})==null?u=new x(d.InvalidJoinQuery,"column ".concat(r.column," does not exist in table ").concat(r.table)):a.columns.find(function(v){return v.name===n.column})==null&&(u=new x(d.InvalidJoinQuery,"column ".concat(n.column," does not exist in table ").concat(n.table))),e.as==null&&(e.as={}),o.columns.every(function(v){var y=a.columns.find(function(m){return m.name===v.name&&m.name!==r.column});return y!=null&&e.as[y.name]==null?(u=new x(d.InvalidJoinQuery,"column ".concat(v.name," exist in both table ").concat(r.table," & ").concat(n.table)),!1):!0});var s=e.where;if(s){var l={},c=function(v){var y=a.columns.find(function(m){return m.name===v});y||(l[v]=s[v],delete s[v])};for(var f in s)c(f);e.whereJoin=l,N(s)===0&&(e.where=null)}return u},i}(),wt=function(){function i(t){this.data=t}return Object.defineProperty(i.prototype,"indexNames",{get:function(){var t=re(this.data[0]);return{contains:function(e){return t.indexOf(e)>=0}}},enumerable:!1,configurable:!0}),i.prototype.index=function(t){var e=this;return{openCursor:function(r){var n={},o=0,a={continue:function(){++o,s()}},u=function(l){n.onsuccess({target:{result:l}})},s=function(){var l=e.data[o];if(l){var c=l[t];c&&(r==null||r.includes(c))?(a.key=c,a.value=l,u(a)):a.continue()}else u(null)};return M().then(s),n}}},i}(),kt=function(){var i=function(t,e){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(r[o]=n[o])},i(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");i(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),oe=function(){return oe=Object.assign||function(i){for(var t,e=1,r=arguments.length;e<r;e++){t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(i[n]=t[n])}return i},oe.apply(this,arguments)},ae=function(i,t,e){if(e||arguments.length===2)for(var r=0,n=t.length,o;r<n;r++)(o||!(r in t))&&(o||(o=Array.prototype.slice.call(t,0,r)),o[r]=t[r]);return i.concat(o||Array.prototype.slice.call(t))},C=function(i){kt(t,i);function t(e,r){var n=i.call(this)||this;n.sorted=!1,n.isSubQuery=!1,n.thenEvaluator=new Ye,n.returnResult_=function(){if(n.results.length>0){var a=n.query;if(a.flatten){var u=[],s=new Map;a.flatten.forEach(function(c){n.results.forEach(function(f,v){f[c].forEach(function(y){var m;u.push(oe(oe({},f),(m={},m[c]=y,m)))}),s.set(v,!0)})});var l=0;s.forEach(function(c,f){n.results.splice(f-l,1),++l}),n.results=n.results.concat(u)}n.processGroupDistinctAggr(),n.processOrderBy(),n.skipAtEnd&&n.results.splice(0,a.skip),n.limitAtEnd&&(n.results=n.results.slice(0,a.limit))}return n.results},n.query=e,n.util=r,n.tableName=e.from,n.setPushResult(),F(e.where)?(n.isArrayQry=!0,n.setLimitAndSkipEvaluationAtEnd_()):(n.skipRecord=e.skip,n.limitRecord=e.limit);var o=e.order;return o?((F(o)||o.case||ze(o.by))&&(o.idbSorting=!1),n.setLimitAndSkipEvaluationAtEnd_()):e.groupBy&&n.setLimitAndSkipEvaluationAtEnd_(),n}return t.prototype.execute=function(e){var r=this,n;e||(e=function(){return M(null)});var o=this.query;try{var a=new X(this.db).validate(g.Select,o);return a?L(a):e().then(function(u){return r.initTransaction_(),o.join==null?o.where!=null?F(o.where)?n=r.processWhereArrayQry():n=r.processWhere_():n=r.executeWhereUndefinedLogic():n=r.executeJoinQuery(),n.then(r.returnResult_.bind(r))})}catch(u){return this.onException(u)}},t.prototype.processWhereArrayQry=function(){var e=this;this.isArrayQry=!0;var r=this.query.where,n=this.primaryKey(),o=!0,a=[],u,s=function(f){return a.findIndex(function(v){return v[n]===f})>=0},l=function(){if(u===h.And){var f=function(){var v=[];e.results.forEach(function(y){s(y[n])&&v.push(y)}),a=v,v=null};o===!0?a=e.results:a.length>0&&f()}else a.length>0&&(e.results=ae(ae([],a,!0),e.results,!0),e.removeDuplicates()),a=e.results;if(o=!1,r.length>0)return e.results=[],c();e.results=a},c=function(){var f=r.shift();return f[h.Or]&&N(f)===1?(u=h.Or,f=f[h.Or]):u=h.And,e.query.where=f,e.processWhere_().then(l)};return c()},t.prototype.initTransaction_=function(){var e=this.query.store;if(e){this.objectStore=new wt(e);return}this.isTxQuery||this.util.createTransactionIfNotExist([this.tableName],J.ReadOnly),this.objectStore=this.util.objectStore(this.tableName)},t.prototype.processWhere_=function(){var e=this;return this.shouldAddValue=function(r){return e.whereChecker.check(r.value)},this.query.where.or&&this.processOrLogic_(),this.goToWhereLogic().then(function(){return e.onWhereEvaluated()})},t.prototype.onWhereEvaluated=function(){if(this.isOr)return this.orQuerySuccess_()},t.prototype.orQueryFinish_=function(){this.isOr=!1,this.results=this.orInfo.results,this.orInfo=null,this.removeDuplicates()},t.prototype.orQuerySuccess_=function(){var e=this.query;this.results.length>0&&(this.orInfo.results=ae(ae([],this.orInfo.results,!0),this.results,!0)),this.results=[];var r=Z(this.orInfo.orQuery);if(r!=null){var n={};return n[r]=this.orInfo.orQuery[r],delete this.orInfo.orQuery[r],e.where=n,this.goToWhereLogic().then(this.onWhereEvaluated.bind(this))}return this.orQueryFinish_()},t.prototype.processOrLogic_=function(){this.isOr=!0;var e=this.query.where;this.orInfo={orQuery:e.or,results:[]},this.setLimitAndSkipEvaluationAtEnd_(),delete e.or},t}(ie);C.prototype.executeInLogic=_t,C.prototype.executeWhereUndefinedLogic=nt,C.prototype.executeWhereLogic=et,C.prototype.executeRegexLogic=mt,C.prototype.setLimitAndSkipEvaluationAtEnd_=Xe,C.prototype.setPushResult=$e,C.prototype.removeDuplicates=Ze,C.prototype.executeJoinQuery=bt,C.prototype.processGroupDistinctAggr=st,C.prototype.processOrderBy=vt,C.prototype.processAggregateQry=pt,C.prototype.executeAggregateGroupBy=yt,C.prototype.processGroupBy=dt;var St=function(){var i=this,t,e=this.objectStore,r=function(){if(e.count)return t=e.count(),function(o){return function(){i.resultCount=t.result,o()}};var n;return t=e.openCursor(),function(o){return function(a){n=a.target.result,n?(++i.resultCount,n.continue()):o()}}}();return w(function(n,o){t.onerror=o,t.onsuccess=r(n)})},he=function(i){var t=this;return function(e){var r=e.target.result;r?(t.shouldAddValue(r)&&++t.resultCount,r.continue()):i()}},Tt=function(i,t,e){var r=this;t=e?t[e]:t;var n,o=N(this.query.where)===1,a=this.objectStore;return w(function(u,s){o&&a.count?(n=a.index(i).count(r.util.keyRange(t,e)),n.onsuccess=function(){r.resultCount=n.result,u()}):(n=a.index(i).openCursor(r.util.keyRange(t,e)),n.onsuccess=he.call(r,u)),n.onerror=s})},Ot=function(i,t){var e=this,r=this.objectStore.index(i).openCursor();return this.shouldAddValue=function(n){return t.test(n.key)&&e.whereChecker.check(n.value)},w(function(n,o){r.onerror=o,r.onsuccess=he.call(e,n)})},Et=function(i,t){var e=this,r=this.objectStore,n=r.index(i),o=N(this.query.where)===1,a=function(u){var s=e.util.keyRange(u);return o&&r.count?w(function(l,c){var f=n.count(s);f.onsuccess=function(v){e.resultCount+=v.target.result,l()},f.onerror=c}):w(function(l,c){var f=n.openCursor(s);f.onsuccess=he.call(e,l),f.onerror=c})};return z(t.map(function(u){return a(u)}))},Ct=function(){var i=function(t,e){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(r[o]=n[o])},i(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");i(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),U=function(i){Ct(t,i);function t(e,r){var n=i.call(this)||this;return n.resultCount=0,n.query=e,n.util=r,n.tableName=e.from,n}return t.prototype.execute=function(e){var r=this,n=new X(this.db),o=this.query,a=n.validate(g.Count,o);return a?L(a):e().then(function(u){var s;try{var l=function(){var c=new C(o,r.util);return c.isTxQuery=r.isTxQuery,c.execute().then(function(f){r.resultCount=f.length})};r.initTransaction_(),o.join==null?o.where!=null?o.where.or||F(o.where)?s=l():(r.shouldAddValue=function(c){return r.whereChecker.check(c.value)},s=r.goToWhereLogic()):s=r.executeWhereUndefinedLogic():s=l()}catch(c){r.onException(c)}return s.then(function(c){return r.resultCount})})},t.prototype.initTransaction_=function(){var e=this.query.from;this.isTxQuery||this.util.createTransaction([e],J.ReadOnly),this.objectStore=this.util.objectStore(e)},t}(ie);U.prototype.executeWhereUndefinedLogic=St,U.prototype.executeWhereLogic=Tt,U.prototype.executeRegexLogic=Ot,U.prototype.executeInLogic=Et;var ee=function(i){var t=F(i)?i:i.split(".");return t.reduce(function(e,r){return e&&e[r]},self)},ue=function(i,t){var e=i.set,r=i.mapSet;if(r){var n=r(e,t);n!=null&&(e=n)}for(var o in e){var a=e[o];if(E(a)!==k.Object)t[o]=a;else for(var u in a){var s=a[u];switch(u){case"+":t[o]+=s;break;case"-":t[o]-=s;break;case"*":t[o]*=s;break;case"/":t[o]/=s;break;case"{push}":t[o].push(s);break;default:t[o]=a}break}}return t},jt=function(){var i=this,t=this.objectStore.openCursor();return w(function(e,r){t.onsuccess=function(n){var o=n.target.result;if(o)try{var a=o.update(ue(i.query,o.value));a.onsuccess=function(){++i.rowAffected,o.continue()},a.onerror=r}catch(u){r(u)}else e()},t.onerror=r})},It=function(i,t){var e=this,r=this.objectStore.index(i),n=this.query,o=function(a){return w(function(u,s){var l=r.openCursor(e.util.keyRange(a));l.onsuccess=function(c){var f=c.target.result;if(f){var v=f.value;if(e.whereChecker.check(v))try{var y=f.update(ue(n,v));y.onsuccess=function(){++e.rowAffected,f.continue()},y.onerror=s}catch(m){s(m)}else f.continue()}else u()},l.onerror=s})};return z(t.map(function(a){return o(a)}))},Lt=function(i,t){var e=this,r,n=this.objectStore.index(i).openCursor();return this.shouldAddValue=function(o){return t.test(o.key)&&e.whereChecker.check(o.value)},w(function(o,a){n.onsuccess=function(u){if(r=u.target.result,r)if(e.shouldAddValue(r))try{var s=r.update(ue(e.query,r.value));s.onsuccess=function(){++e.rowAffected,r.continue()},s.onerror=a}catch(l){a(l)}else r.continue();else o()},n.onerror=a})},At=function(i,t,e){var r=this,n=this.query;t=e?t[e]:t;var o=this.objectStore.index(i).openCursor(this.util.keyRange(t,e));return w(function(a,u){o.onsuccess=function(s){var l=s.target.result;if(l)if(r.whereChecker.check(l.value))try{var c=l.update(ue(n,l.value));c.onsuccess=function(){++r.rowAffected,l.continue()},c.onerror=u}catch(f){u(f)}else l.continue();else a()},o.onerror=u})},Rt=function(){var i=function(t,e){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(r[o]=n[o])},i(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");i(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),H=function(i){Rt(t,i);function t(e,r){var n=i.call(this)||this;n.query=e,n.util=r,n.tableName=e.in;var o=e.mapSet;if(o){var a=E(o)===k.String?ee(o):o;if(!a)throw new x(d.MethodNotExist,o);e.mapSet=a}return n}return t.prototype.execute=function(e){var r=this,n=this.query;try{var o=new X(this.db),a=o.validate(g.Update,n);return a?L(a):e().then(function(u){r.initTransaction();var s;return n.where!=null?n.where.or||F(n.where)?s=r.executeComplexLogic_():s=r.goToWhereLogic():s=r.executeWhereUndefinedLogic(),s.then(function(){return r.rowAffected})})}catch(u){return this.onException(u)}},t.prototype.executeComplexLogic_=function(){var e=this,r=this.query,n=new C({from:r.in,where:r.where,ignoreCase:r.ignoreCase},this.util);return n.isTxQuery=this.isTxQuery,n.execute().then(function(o){var a,u,s=e.primaryKey(r.in),l=[];o.forEach(function(f){l.push(f[s])}),o=null;var c=(a={},a[s]=(u={},u[h.In]=l,u),a);return e.query.where=c,e.initTransaction(),e.goToWhereLogic()})},t.prototype.initTransaction=function(){var e=this.query.in;this.isTxQuery||this.util.createTransaction([e]),this.objectStore=this.util.objectStore(e)},t}(ie);H.prototype.executeWhereUndefinedLogic=jt,H.prototype.executeWhereLogic=At,H.prototype.executeRegexLogic=Lt,H.prototype.executeInLogic=It;var qt=function(){var i=function(t,e){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(r[o]=n[o])},i(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");i(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),ve=function(){return ve=Object.assign||function(i){for(var t,e=1,r=arguments.length;e<r;e++){t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(i[n]=t[n])}return i},ve.apply(this,arguments)},Qt=function(i){qt(t,i);function t(e,r){var n=i.call(this)||this;return n.query=e,n.util=r,n}return t.prototype.execute=function(){var e=this,r=this.query,n=0,o={},a={},u=!0,s=r.queries,l=s.length;s.every(function(m,p){return p+1<l&&m.from!==s[p+1].from?(u=!1,!1):!0});var c;if(u){var f=this.primaryKey(s[0].from);c=function(m){return m[f]}}else c=function(m){var p="";for(var b in m)p+=m[b];return p};var v,y=function(){if(n<l)return v=new C(s[n],e.util),v.execute().then(function(O){return o={},O.forEach(function(A){var R=c(A);n===0?a[R]=A:a[R]!=null&&(o[R]=A)}),n>0&&(a=ve({},o)),++n,y()});var m=[],p=void 0,b=r.skip,j=r.limit,W=function(){return v.results=m,Object.assign(v.query,{order:r.order,join:{}}),v.processOrderBy(),v.processGroupDistinctAggr(),v.results},D=!1,Q,T=function(){m.push(o[Q])},_=function(){m.length<j?T():D=!0},S=function(O){b===0?O():--b};if(r.skip&&r.limit?p=function(){S(function(){_()})}:r.limit?p=_:r.skip?p=function(){S(function(){T()})}:p=function(){T()},j){for(Q in o)if(p(Q),D)break}else for(Q in o)p(Q);return W()};return y()},t}(G),Dt=function(){function i(){}return i.prototype.execute=function(t){return w(function(e,r){var n=indexedDB.deleteDatabase(t);n.onblocked=function(){var o=new x(d.DbBlocked);return r(te(o))},n.onerror=function(o){return r(te(o))},n.onsuccess=function(){e()}})},i}(),Nt=function(){var i=function(t,e){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(r[o]=n[o])},i(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");i(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),Wt=function(i){Nt(t,i);function t(e,r){var n=i.call(this)||this;return n.query=e,n.util=r,n}return t.prototype.execute=function(){var e=this,r=this.query,n=0,o=new Map,a=!0,u=r.length;r.every(function(v,y){return y+1<u&&v.from!==r[y+1].from?(a=!1,!1):!0});var s;if(a){var l=this.primaryKey(r[0].from);s=function(v){return v[l]}}else s=function(v){var y="";for(var m in v)y+=v[m];return y};var c,f=function(){return n<r.length?(c=new C(r[n++],e.util),c.execute().then(function(v){return v.forEach(function(y){o.set(s(y),y)}),f()})):Array.from(o.values())};return f()},t}(G),Bt=function(){var i=this,t,e=this.objectStore.openCursor();return w(function(r,n){e.onsuccess=function(o){t=o.target.result,t?(t.delete(),++i.rowAffected,t.continue()):r()},e.onerror=n})},Be=function(i){var t=this;return function(e){var r=e.target.result;r?(t.shouldAddValue(r.value)&&(r.delete(),++t.rowAffected),r.continue()):i()}},Mt=function(i,t,e){var r=this;t=e?t[e]:t;var n=this.objectStore.index(i).openCursor(this.util.keyRange(t,e));return w(function(o,a){n.onsuccess=Be.call(r,o),n.onerror=a})},Vt=function(i,t){var e=this,r=this.objectStore.index(i),n=function(o){return w(function(a,u){var s=r.openCursor(e.util.keyRange(o));s.onsuccess=Be.call(e,a),s.onerror=u})};return z(t.map(function(o){return n(o)}))},Ft=function(i,t){var e=this,r,n=this.objectStore.index(i).openCursor();return this.shouldAddValue=function(o){return t.test(o.key)&&e.whereChecker.check(o.value)},w(function(o,a){n.onsuccess=function(u){r=u.target.result,r?(e.shouldAddValue(r)&&(r.delete(),++e.rowAffected),r.continue()):o()},n.onerror=a})},Kt=function(){var i=function(t,e){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(r[o]=n[o])},i(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");i(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),P=function(i){Kt(t,i);function t(e,r){var n=i.call(this)||this;return n.query=e,n.util=r,n.tableName=e.from,n}return t.prototype.execute=function(e){var r=this,n=new X(this.db),o=this.query,a=n.validate(g.Remove,o);if(a)return L(a);var u;return e().then(function(s){try{r.initTransaction_(),o.where!=null?F(o.where)?u=r.processWhereArrayQry():u=r.processWhere_():u=r.executeWhereUndefinedLogic()}catch(l){return r.onException(l)}return u.then(function(){return r.rowAffected})})},t.prototype.processWhereArrayQry=function(){var e=this,r=new C(this.query,this.util);return r.isTxQuery=this.isTxQuery,r.execute().then(function(n){var o,a,u=[],s=e.primaryKey(e.query.from);n.forEach(function(c){u.push(c[s])}),n=null;var l=(o={},o[s]=(a={},a[h.In]=u,a),o);return e.query[h.Where]=l,e.processWhere_()})},t.prototype.processWhere_=function(){var e=this;return this.shouldAddValue=function(r){return e.whereChecker.check(r)},this.query.where.or&&this.processOrLogic(),this.goToWhereLogic().then(function(){return e.onWhereEvaluated()})},t.prototype.initTransaction_=function(){this.isTxQuery||this.util.createTransaction([this.query.from]),this.objectStore=this.util.objectStore(this.query.from)},t.prototype.onWhereEvaluated=function(){if(this.isOr)return this.orQuerySuccess_()},t.prototype.orQuerySuccess_=function(){var e=this,r=this._orInfo.OrQuery,n=Z(r);if(n!=null){var o={};return o[n]=r[n],delete r[n],this.query.where=o,this.goToWhereLogic().then(function(){return e.onWhereEvaluated()})}else this.isOr=!0},t.prototype.processOrLogic=function(){this.isOr=!0;var e=this.query.where;this._orInfo={OrQuery:e.or},delete e.or},t}(ie);P.prototype.executeInLogic=Vt,P.prototype.executeWhereUndefinedLogic=Bt,P.prototype.executeWhereLogic=Mt,P.prototype.executeRegexLogic=Ft;var Jt=function(){var i=function(t,e){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(r[o]=n[o])},i(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");i(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),Gt=function(i){Jt(t,i);function t(e,r){var n=i.call(this)||this;return n.query=e,n.util=r,n.tableName=e,n}return t.prototype.execute=function(e){var r=this,n=this.query;return this.isTxQuery||this.util.createTransaction([n,I.tableName]),e().then(function(o){var a=r.util.objectStore(n).clear();try{return w(function(u,s){a.onsuccess=function(l){var c=r.table(n);for(var f in c.autoIncColumnValue)c.autoIncColumnValue[f]=0;I.set(I.dbSchema,r.util.db,r.util).then(function(){u()}).catch(s)},a.onerror=s})}catch(u){return r.onException(u)}})},t}(G),Ut=function(){var i=function(t,e){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(r[o]=n[o])},i(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");i(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),Ht=function(i){Ut(t,i);function t(e,r){var n=i.call(this)||this;return n.results={},n.reqQueue=[],n.isQueryExecuting=!1,n.isTxStarted_=!1,n.query=e,n.util=r,n}return t.prototype.execute=function(e){var r=this;this.beforeExecute=e;var n=this.validate();return n?L(n):(this.startExecution_(),w(function(o,a){r.onSuccess=o,r.onError=a}).then(function(o){return r.beforeExecute=null,r.log("transaction finished"),o}))},t.prototype.validate=function(){var e=this.query,r=this.notExistingTable_(e.tables);if(r)return new x(d.TableNotExist,{tableName:r});var n=e.method,o=ee(n);if(!o)return new x(d.MethodNotExist,n)},t.prototype.startExecution_=function(){var e=this,r=this.query,n=function(f){return function(v){return e.pushReq_({name:f,query:v})}},o=function(f,v){e.results[f]=v},a=function(f){return e.results[f]},u=function(f){e.abortTx_(f)},s=function(){e.startTx_()},l=r.method,c=ee(l);return this.log("transaction query started"),c.call(this,{data:r.data,insert:n(g.Insert),select:n(g.Select),update:n(g.Update),remove:n(g.Remove),count:n(g.Count),setResult:o,getResult:a,abort:u,start:s})},t.prototype.log=function(e){this.util.logger.log(e)},t.prototype.startTx_=function(){var e=this;try{this.isTxStarted_=!0;var r=this.query.tables;return r=r.concat(I.tableName),this.util.createTransaction(r).then(function(n){e.onSuccess(e.results)}).catch(function(n){e.onError(n)}),this.processExecutionOfQry_()}catch(n){this.onError(this.onException(n))}},t.prototype.onReqFinished_=function(e){var r=this.reqQueue.shift();this.log("finished request : ".concat(r.name," ")),r&&(e.error?(this.abortTx_("automatic abort of transaction due to error occured"),this.log("transaction aborted due to error occured"),this.onError(e.error)):(this.isQueryExecuting=!1,r.onSuccess&&r.onSuccess(e),this.processExecutionOfQry_()))},t.prototype.abortTx_=function(e){this.reqQueue=[],this.util.abortTransaction(),this.log("transaction aborted. Msg : ".concat(e))},t.prototype.executeRequest_=function(e){var r=this;this.isQueryExecuting=!0;var n;this.log("executing request : ".concat(e.name," "));var o=this.onReqFinished_.bind(this),a=e.query,u=function(s){n=new s(a,r.util)};switch(e.name){case g.Select:u(C);break;case g.Insert:u(ke);break;case g.Update:u(H);break;case g.Remove:u(P);break;case g.Count:u(U);break}n.isTxQuery=!0,n.execute(this.beforeExecute).then(o).catch(function(s){var l={error:s};o(l)})},t.prototype.pushReq_=function(e){var r=w(function(n,o){e.onSuccess=function(a){n(a)},e.onError=function(a){o(a)}});return this.reqQueue.push(e),this.isTxStarted_===!0&&this.processExecutionOfQry_(),this.log("request pushed : ".concat(e.name)),r},t.prototype.processExecutionOfQry_=function(){this.isQueryExecuting===!1&&this.reqQueue.length>0&&this.executeRequest_(this.reqQueue[0])},t.prototype.notExistingTable_=function(e){var r=this,n=null;return e.every(function(o){var a=r.table(o);return a==null?(n=o,!1):!0}),n},t}(G),pe=function(i){var t={name:i.name,version:i.version,tables:[]};return i.tables.forEach(function(e){var r={name:e.name,columns:{}};e.columns.forEach(function(n){r.columns[n.name]=n}),t.tables.push(r)}),t},Me=function(){function i(t){this.middlewares=[],this.util=new we,this.onQryFinished=Se?function(e){self.postMessage(e)}:t}return Object.defineProperty(i.prototype,"db",{get:function(){return this.util.db},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"logger",{get:function(){return this.util.logger},enumerable:!1,configurable:!0}),i.prototype.executeMiddleware_=function(t){var e=this,r=N(this.middlewares)-1;if(r<0)return M();var n={},o=this.db;return Object.defineProperty(n,"database",{get:function(){return pe(o)}}),w(function(a){var u=0,s=function(){if(u<=r){var l=ee(e.middlewares[u++])(t,n);(!l||!l.then)&&(l=Promise.resolve(l)),l.then(function(c){s()})}else a()};s()})},i.prototype.executeQuery=function(t,e){var r,n=t.query,o=this,a=o.util,u=function(l,c){r=new l(n,a).execute(c)};switch(t.name){case g.OpenDb:e(),r=o.openDb(n);break;case g.InitDb:e(),r=o.initDb(n);break;case g.CloseDb:e(),r=o.closeDb();break;case g.Insert:u(ke,e);break;case g.Select:u(C,e);break;case g.Count:u(U,e);break;case g.Update:u(H,e);break;case g.Intersect:e(),u(Qt);break;case g.DropDb:e(),r=o.dropDb();break;case g.Terminate:e(),r=o.terminate();break;case g.Union:e(),u(Wt);break;case g.Remove:u(P,e);break;case g.Clear:u(Gt,e);break;case g.Transaction:u(Ht,e);break;case g.Get:e(),r=I.get(n,a);break;case g.Set:e(),r=I.set(n.key,n.value,a);break;case g.ImportScripts:e(),r=o.importScripts_(t);break;case g.ChangeLogStatus:e(),o.logger.status=n,r=Promise.resolve();break;case g.Middleware:e();var s=ee(n);return s?(o.middlewares.push(n),M()):L(new x(d.InvalidMiddleware,n));default:console.error("The Api:-"+t.name+" does not support."),r=M()}return o.logger.log("Executing query ".concat(t.name," in web worker")),r},i.prototype.callMiddleware_=function(t,e){return w(function(r){var n=0,o=N(t)-1,a=function(){if(n<=o){var u=t[n++](e);u instanceof Promise||(u=M(u)),u.then(function(s){e=s,a()})}else r(e)};a()})},i.prototype.run=function(t){var e=this,r=[],n=[];t.onResult=function(o){r.push(function(a){return o(a)})},t.beforeExecute=function(o){n.push(function(a){return o(a)})},this.executeMiddleware_(t).then(function(o){return e.executeQuery(t,function(){return e.callMiddleware_(n)}).then(function(a){return e.callMiddleware_(r,a).then(function(u){e.returnResult_({result:u})})})}).catch(function(o){r=[];var a=te(o),u={error:a};e.returnResult_(u)})},i.prototype.importScripts_=function(t){return w(function(e,r){try{importScripts.apply(void 0,t.query),e()}catch(o){var n=new x(d.ImportScriptsFailed,o.message);r(n)}})},i.prototype.returnResult_=function(t){this.logger.log("Query finished inside web worker"),this.util&&this.util.emptyTx(),this.onQryFinished(t)},i.prototype.dropDb=function(){var t=this.db.name;return this.terminate().then(function(){return new Dt().execute(t)})},i.prototype.closeDb=function(){return this.util.close()},i.prototype.terminate=function(){var t=this;return this.closeDb().then(function(){t.util.db=null})},i.prototype.openDb=function(t){var e=this;return this.closeDb().then(function(r){var n;return e.db&&t.name===e.db.name?n=e.initDb():n=e.initDb({name:t.name,tables:[],version:t.version}),n.then(function(){return e.db})})},i.prototype.initDb=function(t){var e=this;if(!Pe)return L(new x(d.IndexedDbNotSupported));var r=t?new Fe(t):this.db;return this.util=new we,w(function(n,o){e.util.initDb(r).then(function(a){a.isCreated?I.get(I.dbSchema,e.util).then(function(u){u&&u.tables.forEach(function(s,l){var c=r.tables[l];c&&(c.autoIncColumnValue=s.autoIncColumnValue)}),e.util.db=r,a.database=pe(e.db),I.set(I.dbSchema,r,e.util).then(function(){n(a)})}):I.get(I.dbSchema,e.util).then(function(u){e.util.db=u,a.database=pe(e.db),n(a)})}).catch(o)})},i}();if(Se){var Pt=new Me;self.onmessage=function(i){Pt.run(i.data)}}})()})()})();
